import{c as V,r as c,j as e,Z as ae,S as le,U as ne,I as Z,T as re,L as Q,X as ie,D as oe,a as de}from"./zap-B5NJP0TS.js";import{H as ce,A as te}from"./history-BUu66xkO.js";import{S as xe}from"./sliders-vertical-B4YxICxR.js";const ge=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M12 3v18",key:"108xh3"}]],me=V("columns-2",ge);const pe=[["path",{d:"M6 2v14a2 2 0 0 0 2 2h14",key:"ron5a4"}],["path",{d:"M18 22V8a2 2 0 0 0-2-2H2",key:"7s9ehn"}]],se=V("crop",pe);const he=[["path",{d:"M12 22a7 7 0 0 0 7-7c0-2-1-3.9-3-5.5s-3.5-4-4-6.5c-.5 2.5-2 4.9-4 6.5C6 11.1 5 13 5 15a7 7 0 0 0 7 7z",key:"c7niix"}]],ue=V("droplet",he);const fe=[["rect",{width:"18",height:"7",x:"3",y:"3",rx:"1",key:"f1a2em"}],["rect",{width:"9",height:"7",x:"3",y:"14",rx:"1",key:"jqznyg"}],["rect",{width:"5",height:"7",x:"16",y:"14",rx:"1",key:"q5h2i8"}]],J=V("layout-template",fe);const be=[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]],je=V("maximize",be);const Ne=[["path",{d:"M12 2v20",key:"t6zp3m"}],["path",{d:"m15 19-3 3-3-3",key:"11eu04"}],["path",{d:"m19 9 3 3-3 3",key:"1mg7y2"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"m5 9-3 3 3 3",key:"j64kie"}],["path",{d:"m9 5 3-3 3 3",key:"l8vdw6"}]],K=V("move",Ne);const ve=[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M7 12h10",key:"b7w52i"}]],we=V("scan-line",ve);const ye=[["path",{d:"M12 4v16",key:"1654pz"}],["path",{d:"M4 7V5a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v2",key:"e0r10z"}],["path",{d:"M9 20h6",key:"s66wpe"}]],Ce=V("type",ye),a={defaults:{algorithm:"classic",threshold:{adaptive:60,classic:130},contrastBoost:15,scaleMultiplier:1.5,smoothness:15,autoCrop:!0,paddingMode:"uniform",padding:{top:50,right:50,bottom:50,left:50},backgroundColor:"#FFFFFF",isTransparent:!1},ranges:{scale:{min:1,max:3,step:.5},threshold:{adaptive:{min:0,max:100},classic:{min:50,max:220}},contrastBoost:{min:0,max:60},smoothness:{min:0,max:20},padding:{min:0,max:300}}},ee=async(O,E)=>new Promise((l,L)=>{const r=new Image;r.crossOrigin="Anonymous",r.onload=()=>{try{const{algorithm:y,threshold:w,contrastBoost:C,scaleMultiplier:k,smoothness:I=0,autoCrop:N,paddingTop:B,paddingRight:T,paddingBottom:_,paddingLeft:b,backgroundColor:U="#FFFFFF",isTransparent:h=!1}=E,A=r.width,p=A*k,G=p/A,f=r.height*G,S=document.createElement("canvas");S.width=p,S.height=f;const F=S.getContext("2d");if(!F)throw new Error("Could not get scaled canvas context");F.imageSmoothingEnabled=!0,F.imageSmoothingQuality="high",F.drawImage(r,0,0,p,f);const M=document.createElement("canvas");M.width=p,M.height=f;const $=M.getContext("2d");if(!$)throw new Error("Could not get working canvas context");$.drawImage(S,0,0);const H=$.getImageData(0,0,p,f),i=H.data,Y=(x,o,j)=>{if(j===0)return x<o?0:255;const v=o-j,g=o+j;return x<=v?0:x>=g?255:(x-v)/(g-v)*255};let R=255,W=255,D=255;if(!h&&U.startsWith("#")){const x=U.substring(1);R=parseInt(x.substring(0,2),16),W=parseInt(x.substring(2,4),16),D=parseInt(x.substring(4,6),16)}if(y==="adaptive"){const x=document.createElement("canvas");x.width=p,x.height=f;const o=x.getContext("2d");if(!o)throw new Error("Could not get blur canvas context");const j=20*k;o.filter=`blur(${j}px)`,o.drawImage(M,0,0),o.clearRect(0,0,p,f),o.drawImage(r,0,0,p,f);const v=o.getImageData(0,0,p,f).data;for(let g=0;g<i.length;g+=4){const t=i[g],s=v[g],n=(100-w)/2,d=s-n,m=Y(t,d,I),u=m/255;h?(i[g]=0,i[g+1]=0,i[g+2]=0,i[g+3]=255-m):(i[g]=R*u,i[g+1]=W*u,i[g+2]=D*u,i[g+3]=255)}}else{const x=C/100;for(let o=0;o<i.length;o+=4){let j=i[o];j<w+40&&(j=j*(1-x));const v=Y(j,w,I),g=v/255;h?(i[o]=0,i[o+1]=0,i[o+2]=0,i[o+3]=255-v):(i[o]=R*g,i[o+1]=W*g,i[o+2]=D*g,i[o+3]=255)}}$.putImageData(H,0,0);let P="",X="";if(N){let x=p,o=f,j=0,v=0,g=!1;for(let t=0;t<f;t++)for(let s=0;s<p;s++){const n=(t*p+s)*4;let d=!1;h?i[n+3]>10&&(d=!0):Math.abs(i[n]-R)+Math.abs(i[n+1]-W)+Math.abs(i[n+2]-D)>30&&(d=!0),d&&(s<x&&(x=s),s>j&&(j=s),t<o&&(o=t),t>v&&(v=t),g=!0)}if(g){const t=j-x+1,s=v-o+1,n=t+b+T,d=s+B+_,m=document.createElement("canvas");m.width=n,m.height=d;const u=m.getContext("2d");if(!u)throw new Error("Could not get final canvas context");h?u.clearRect(0,0,n,d):(u.fillStyle=U,u.fillRect(0,0,n,d)),u.drawImage(M,x,o,t,s,b,B,t,s),P=m.toDataURL("image/png");const z=document.createElement("canvas");z.width=n,z.height=d;const q=z.getContext("2d");if(!q)throw new Error("Could not get final org canvas context");h?q.clearRect(0,0,n,d):(q.fillStyle=U,q.fillRect(0,0,n,d)),q.drawImage(S,x,o,t,s,b,B,t,s),X=z.toDataURL("image/png")}else P=M.toDataURL("image/png"),X=S.toDataURL("image/png")}else P=M.toDataURL("image/png"),X=S.toDataURL("image/png");l({processed:P,croppedOriginal:X})}catch(y){L(y)}},r.onerror=y=>L(y),r.src=O}),ke=({originalUrl:O,processedUrl:E,croppedOriginalUrl:l,settings:L,viewMode:r})=>{const[y,w]=c.useState(50),[C,k]=c.useState(!0),I=c.useRef(null),N=c.useRef(!1),B=c.useCallback(_=>{if(!I.current)return;const b=I.current.getBoundingClientRect(),U=Math.max(0,Math.min(_-b.left,b.width));w(U/b.width*100)},[]);if(c.useEffect(()=>{const _=()=>N.current=!1,b=h=>{N.current&&B(h.clientX)},U=h=>{N.current&&B(h.touches[0].clientX)};return window.addEventListener("mouseup",_),window.addEventListener("mousemove",b),window.addEventListener("touchmove",U,{passive:!1}),()=>{window.removeEventListener("mouseup",_),window.removeEventListener("mousemove",b),window.removeEventListener("touchmove",U)}},[B]),!O)return null;const T=C&&l?l:O;return e.jsxs("div",{className:"relative w-full h-full flex flex-col",children:[e.jsx("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 z-30 flex gap-2",children:l&&e.jsxs("button",{onClick:()=>k(!C),className:`px-3 py-1.5 rounded-full text-xs font-bold shadow-lg backdrop-blur-md border transition-all flex items-center gap-1.5
                        ${C?"bg-emerald-500/90 text-white border-emerald-400":"bg-white/80 text-slate-600 border-slate-200 hover:bg-white"}
                        `,children:[e.jsx(se,{className:"w-3 h-3"}),C?"同步裁切 (Sync)":"原始比例 (Raw)"]})}),e.jsx("div",{className:"flex-1 flex items-center justify-center bg-slate-200/50 select-none p-4 overflow-hidden",children:e.jsxs("div",{ref:I,className:"relative shadow-2xl bg-white max-w-full max-h-full",onMouseDown:()=>r==="split"&&(N.current=!0),onTouchStart:()=>r==="split"&&(N.current=!0),children:[e.jsx("img",{src:T,alt:"Original",className:`block max-w-full max-h-[85vh] object-contain pointer-events-none ${r==="processed"?"opacity-0":""}`}),E&&(r==="split"||r==="processed")&&e.jsx("img",{src:E,alt:"Processed",className:"absolute inset-0 w-full h-full object-contain pointer-events-none bg-white",style:{clipPath:r==="split"?`inset(0 ${100-y}% 0 0)`:"none"}}),r==="split"&&e.jsx("div",{className:"absolute inset-y-0 w-1 bg-indigo-500 cursor-ew-resize z-20 hover:bg-indigo-400 shadow-[0_0_10px_rgba(0,0,0,0.5)]",style:{left:`${y}%`},children:e.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-8 h-8 bg-indigo-600 rounded-full flex items-center justify-center shadow-lg border-2 border-white text-white",children:e.jsx(te,{className:"w-4 h-4"})})}),(r==="split"||r==="processed")&&e.jsxs("div",{className:"absolute top-4 left-4 bg-black/70 text-white text-xs px-2 py-1 rounded backdrop-blur-md z-10 pointer-events-none border border-white/10",children:["處理後 (Processed) ",L?.scaleMultiplier>1&&e.jsxs("span",{className:"text-amber-300 font-bold ml-1",children:[L.scaleMultiplier,"x"]})]}),(r==="split"||r==="original")&&e.jsx("div",{className:"absolute top-4 right-4 bg-black/70 text-white text-xs px-2 py-1 rounded backdrop-blur-md z-10 pointer-events-none border border-white/10",children:C?"原始 (Synced Crop)":"原始 (Original)"})]})})]})},Ue=()=>{const[O,E]=c.useState([]),[l,L]=c.useState(null),[r,y]=c.useState(a.defaults.algorithm),[w,C]=c.useState(a.defaults.threshold.adaptive),[k,I]=c.useState(a.defaults.contrastBoost),[N,B]=c.useState(a.defaults.scaleMultiplier),[T,_]=c.useState(a.defaults.smoothness),[b,U]=c.useState(a.defaults.autoCrop),[h,A]=c.useState(a.defaults.paddingMode),[p,G]=c.useState(a.defaults.padding.top),[f,S]=c.useState(a.defaults.padding.right),[F,M]=c.useState(a.defaults.padding.bottom),[$,H]=c.useState(a.defaults.padding.left),[i,Y]=c.useState(a.defaults.backgroundColor),[R,W]=c.useState(a.defaults.isTransparent),[D,P]=c.useState("split"),X=c.useRef({algorithm:r,threshold:w,contrastBoost:k,scaleMultiplier:N,smoothness:T,autoCrop:b,paddingMode:h,paddingTop:p,paddingRight:f,paddingBottom:F,paddingLeft:$,backgroundColor:i,isTransparent:R});c.useEffect(()=>{X.current={algorithm:r,threshold:w,contrastBoost:k,scaleMultiplier:N,smoothness:T,autoCrop:b,paddingMode:h,paddingTop:p,paddingRight:f,paddingBottom:F,paddingLeft:$,backgroundColor:i,isTransparent:R}},[r,w,k,N,T,b,h,p,f,F,$,i,R]);const x=c.useRef(null);c.useEffect(()=>{if(l&&l.settingsUsed){const t=l.settingsUsed;y(s=>s!==t.algorithm?t.algorithm:s),C(s=>s!==t.threshold?t.threshold:s),I(s=>s!==t.contrastBoost?t.contrastBoost:s),B(s=>s!==t.scaleMultiplier?t.scaleMultiplier:s),_(s=>s!==(t.smoothness??0)?t.smoothness??0:s),U(s=>s!==(t.autoCrop??a.defaults.autoCrop)?t.autoCrop??a.defaults.autoCrop:s),A(s=>s!==(t.paddingMode??a.defaults.paddingMode)?t.paddingMode??a.defaults.paddingMode:s),G(s=>s!==(t.paddingTop??a.defaults.padding.top)?t.paddingTop??a.defaults.padding.top:s),S(s=>s!==(t.paddingRight??a.defaults.padding.right)?t.paddingRight??a.defaults.padding.right:s),M(s=>s!==(t.paddingBottom??a.defaults.padding.bottom)?t.paddingBottom??a.defaults.padding.bottom:s),H(s=>s!==(t.paddingLeft??a.defaults.padding.left)?t.paddingLeft??a.defaults.padding.left:s),Y(s=>s!==(t.backgroundColor??a.defaults.backgroundColor)?t.backgroundColor??a.defaults.backgroundColor:s),W(s=>s!==(t.isTransparent??a.defaults.isTransparent)?t.isTransparent??a.defaults.isTransparent:s)}},[l?.id]),c.useEffect(()=>{if(!l)return;const t={algorithm:r,threshold:w,contrastBoost:k,scaleMultiplier:N,smoothness:T,autoCrop:b,paddingMode:h,paddingTop:p,paddingRight:f,paddingBottom:F,paddingLeft:$,backgroundColor:i,isTransparent:R};if(!(l.settingsUsed.algorithm===t.algorithm&&l.settingsUsed.threshold===t.threshold&&l.settingsUsed.contrastBoost===t.contrastBoost&&l.settingsUsed.scaleMultiplier===t.scaleMultiplier&&l.settingsUsed.smoothness===t.smoothness&&l.settingsUsed.autoCrop===t.autoCrop&&l.settingsUsed.paddingMode===t.paddingMode&&l.settingsUsed.paddingTop===t.paddingTop&&l.settingsUsed.paddingRight===t.paddingRight&&l.settingsUsed.paddingBottom===t.paddingBottom&&l.settingsUsed.paddingLeft===t.paddingLeft&&l.settingsUsed.backgroundColor===t.backgroundColor&&l.settingsUsed.isTransparent===t.isTransparent))return x.current&&clearTimeout(x.current),x.current=setTimeout(async()=>{try{const n=await ee(l.originalUrl,t);L(d=>!d||d.id!==l.id?d:{...d,processedUrl:n.processed,croppedOriginalUrl:n.croppedOriginal,settingsUsed:t,status:"done"}),E(d=>d.map(m=>m.id===l.id?{...m,processedUrl:n.processed,croppedOriginalUrl:n.croppedOriginal,settingsUsed:t,status:"done"}:m))}catch(n){console.error("Live preview failed:",n)}},300),()=>{x.current&&clearTimeout(x.current)}},[r,w,k,N,T,b,h,p,f,F,$,i,R]);const o=c.useCallback(async t=>{if(t.length===0)return;const s=t.map(n=>({id:Math.random().toString(36).substr(2,9),name:n.name.split(".")[0]||"Image",originalUrl:URL.createObjectURL(n),processedUrl:null,croppedOriginalUrl:null,status:"processing",timestamp:new Date,settingsUsed:{...X.current}}));E(n=>[...s,...n]),s.length>0&&L(s[0]),s.forEach(async n=>{try{const d=await ee(n.originalUrl,n.settingsUsed);E(m=>m.map(u=>u.id===n.id?{...u,processedUrl:d.processed,croppedOriginalUrl:d.croppedOriginal,status:"done"}:u)),L(m=>m&&m.id===n.id?{...n,processedUrl:d.processed,croppedOriginalUrl:d.croppedOriginal,status:"done"}:m)}catch(d){console.error("Processing failed:",d),E(m=>m.map(u=>u.id===n.id?{...u,status:"error"}:u))}})},[]),j=t=>{t.target.files&&(o(Array.from(t.target.files)),t.target.value="")};c.useEffect(()=>{const t=s=>{const n=s;if(!n.clipboardData)return;const d=n.clipboardData.items,m=[];for(let u=0;u<d.length;u++)if(d[u].type.indexOf("image")!==-1){const z=d[u].getAsFile();if(z){const q=new File([z],`Paste_${new Date().toLocaleTimeString("en-GB").replace(/:/g,"")}.png`,{type:z.type});m.push(q)}}m.length>0&&o(m)};return window.addEventListener("paste",t),()=>window.removeEventListener("paste",t)},[o]);const v=t=>{if(!t||!t.processedUrl)return;const s=document.createElement("a");s.href=t.processedUrl,s.download=`${t.name}_${t.settingsUsed.algorithm}.png`,document.body.appendChild(s),s.click(),document.body.removeChild(s)},g=(t,s)=>{s.stopPropagation(),E(n=>n.filter(d=>d.id!==t)),l?.id===t&&L(null)};return c.useEffect(()=>{C(r==="adaptive"?a.defaults.threshold.adaptive:a.defaults.threshold.classic)},[r]),e.jsxs("div",{className:"h-screen bg-slate-100 text-slate-800 font-sans flex flex-col md:flex-row overflow-hidden",children:[e.jsxs("div",{className:"w-full md:w-80 lg:w-96 bg-white border-r border-slate-200 flex flex-col h-[45vh] md:h-full z-10 shadow-xl",children:[e.jsx("div",{className:"p-4 border-b border-slate-100 bg-slate-50",children:e.jsxs("h1",{className:"text-xl font-bold text-slate-900 flex items-center gap-2",children:[e.jsx(ce,{className:"w-6 h-6 text-indigo-600"}),"樂譜工作站 ",e.jsx("span",{className:"text-[10px] bg-indigo-100 text-indigo-700 px-1 rounded border border-indigo-200",children:"PRO V3"})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar bg-slate-50",children:[e.jsxs("div",{className:"p-4 border-b border-slate-200 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 text-slate-700",children:[e.jsx(we,{className:"w-4 h-4 text-indigo-500"}),e.jsx("span",{className:"text-sm font-bold",children:"重建解析度 (Scale)"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-xs font-mono w-8 text-right",children:[N,"x"]}),e.jsx("input",{type:"range",min:a.ranges.scale.min,max:a.ranges.scale.max,step:a.ranges.scale.step,value:N,onChange:t=>B(Number(t.target.value)),className:"flex-1 h-2 bg-slate-200 rounded-lg accent-indigo-600 cursor-pointer"})]}),e.jsx("p",{className:"text-[10px] text-slate-400 mt-2 text-right",children:"數值越高邊緣越圓潤，但速度較慢"})]}),e.jsxs("div",{className:"p-4 border-b border-slate-200 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 text-slate-700",children:[e.jsx(ae,{className:"w-4 h-4 text-amber-500"}),e.jsx("span",{className:"text-sm font-bold",children:"處理演算法"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:()=>y("adaptive"),className:`p-2 rounded-lg text-xs font-bold border transition-all flex flex-col items-center gap-1
                                ${r==="adaptive"?"bg-amber-50 border-amber-400 text-amber-800":"bg-slate-50 border-slate-200 text-slate-500 hover:bg-slate-100"}
`,children:[e.jsx(le,{className:"w-4 h-4"}),"自適應 (抗陰影)"]}),e.jsxs("button",{onClick:()=>y("classic"),className:`p-2 rounded-lg text-xs font-bold border transition-all flex flex-col items-center gap-1
                                ${r==="classic"?"bg-indigo-50 border-indigo-400 text-indigo-800":"bg-slate-50 border-slate-200 text-slate-500 hover:bg-slate-100"}
`,children:[e.jsx(Ce,{className:"w-4 h-4"}),"經典 (紅光濾鏡)"]})]}),e.jsx("p",{className:"text-[10px] text-slate-500 mt-2 leading-relaxed",children:r==="adaptive"?"推薦！根據局部光線自動調整，完美去除陰影與紙張皺褶，保留細節。":"適合光線均勻的截圖，能強力去除有色游標。"})]}),e.jsxs("div",{className:"p-4 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 text-slate-700",children:[e.jsx(xe,{className:"w-4 h-4 text-slate-500"}),e.jsx("span",{className:"text-sm font-bold",children:"參數微調"})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("label",{className:"text-xs font-bold text-slate-600",children:r==="adaptive"?"線條靈敏度 (Sensitivity)":"黑白閾值 (Threshold)"}),e.jsx("span",{className:"text-xs font-mono text-indigo-600",children:w})]}),e.jsx("input",{type:"range",min:r==="adaptive"?a.ranges.threshold.adaptive.min:a.ranges.threshold.classic.min,max:r==="adaptive"?a.ranges.threshold.adaptive.max:a.ranges.threshold.classic.max,value:w,onChange:t=>C(Number(t.target.value)),className:"w-full h-1.5 bg-slate-200 rounded-lg accent-indigo-600"}),e.jsx("p",{className:"text-[10px] text-slate-400",children:r==="adaptive"?"越高線條越粗，越低越乾淨":"調整黑白分界點"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("label",{className:"text-xs font-bold text-slate-600 flex items-center gap-1",children:[e.jsx(ue,{className:"w-3 h-3 text-cyan-500"}),"邊緣柔化 (Smoothness)"]}),e.jsx("span",{className:"text-xs font-mono text-indigo-600",children:T})]}),e.jsx("input",{type:"range",min:a.ranges.smoothness.min,max:a.ranges.smoothness.max,value:T,onChange:t=>_(Number(t.target.value)),className:"w-full h-1.5 bg-slate-200 rounded-lg accent-cyan-600"}),e.jsx("p",{className:"text-[10px] text-slate-400",children:"數值越高邊緣越平滑，可消除鋸齒感"})]}),r==="classic"&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("label",{className:"text-xs font-bold text-slate-600",children:"墨色加深"}),e.jsxs("span",{className:"text-xs font-mono text-indigo-600",children:[k,"%"]})]}),e.jsx("input",{type:"range",min:a.ranges.contrastBoost.min,max:a.ranges.contrastBoost.max,value:k,onChange:t=>I(Number(t.target.value)),className:"w-full h-1.5 bg-slate-200 rounded-lg accent-indigo-600"})]})]})]}),e.jsxs("div",{className:"p-4 border-t border-slate-200 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-700",children:[e.jsx(se,{className:"w-4 h-4 text-emerald-500"}),e.jsx("span",{className:"text-sm font-bold",children:"裁切與留白"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:b,onChange:t=>U(t.target.checked),className:"sr-only peer"}),e.jsx("div",{className:"w-9 h-5 bg-slate-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-emerald-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-emerald-500"})]})]}),b&&e.jsxs("div",{className:"space-y-4 animate-in fade-in slide-in-from-top-2 duration-300",children:[e.jsxs("div",{className:"flex bg-slate-100 p-1 rounded-lg",children:[e.jsx("button",{onClick:()=>A("uniform"),className:`flex-1 py-1 text-[10px] font-bold rounded-md transition-all ${h==="uniform"?"bg-white text-emerald-600 shadow-sm":"text-slate-400 hover:text-slate-600"} `,children:"統一"}),e.jsx("button",{onClick:()=>A("axis"),className:`flex-1 py-1 text-[10px] font-bold rounded-md transition-all ${h==="axis"?"bg-white text-emerald-600 shadow-sm":"text-slate-400 hover:text-slate-600"} `,children:"對稱"}),e.jsx("button",{onClick:()=>A("independent"),className:`flex-1 py-1 text-[10px] font-bold rounded-md transition-all ${h==="independent"?"bg-white text-emerald-600 shadow-sm":"text-slate-400 hover:text-slate-600"} `,children:"獨立"})]}),e.jsxs("div",{className:"space-y-2",children:[h==="uniform"&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("label",{className:"text-xs font-bold text-slate-600 flex items-center gap-1",children:[e.jsx(je,{className:"w-3 h-3"})," 四邊留白"]}),e.jsxs("span",{className:"text-xs font-mono text-emerald-600",children:[p,"px"]})]}),e.jsx("input",{type:"range",min:a.ranges.padding.min,max:a.ranges.padding.max,value:p,onChange:t=>{const s=Number(t.target.value);G(s),S(s),M(s),H(s)},className:"w-full h-1.5 bg-slate-200 rounded-lg accent-emerald-500"})]}),h==="axis"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("label",{className:"text-xs font-bold text-slate-600 flex items-center gap-1",children:[e.jsx(K,{className:"w-3 h-3 rotate-90"})," 上下留白"]}),e.jsxs("span",{className:"text-xs font-mono text-emerald-600",children:[p,"px"]})]}),e.jsx("input",{type:"range",min:a.ranges.padding.min,max:a.ranges.padding.max,value:p,onChange:t=>{const s=Number(t.target.value);G(s),M(s)},className:"w-full h-1.5 bg-slate-200 rounded-lg accent-emerald-500"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("label",{className:"text-xs font-bold text-slate-600 flex items-center gap-1",children:[e.jsx(K,{className:"w-3 h-3"})," 左右留白"]}),e.jsxs("span",{className:"text-xs font-mono text-emerald-600",children:[f,"px"]})]}),e.jsx("input",{type:"range",min:a.ranges.padding.min,max:a.ranges.padding.max,value:f,onChange:t=>{const s=Number(t.target.value);S(s),H(s)},className:"w-full h-1.5 bg-slate-200 rounded-lg accent-emerald-500"})]})]}),h==="independent"&&e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500",children:"上 (Top)"}),e.jsx("input",{type:"range",min:a.ranges.padding.min,max:a.ranges.padding.max,value:p,onChange:t=>G(Number(t.target.value)),className:"w-full h-1.5 bg-slate-200 rounded-lg accent-emerald-500"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500",children:"下 (Bottom)"}),e.jsx("input",{type:"range",min:a.ranges.padding.min,max:a.ranges.padding.max,value:F,onChange:t=>M(Number(t.target.value)),className:"w-full h-1.5 bg-slate-200 rounded-lg accent-emerald-500"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500",children:"左 (Left)"}),e.jsx("input",{type:"range",min:a.ranges.padding.min,max:a.ranges.padding.max,value:$,onChange:t=>H(Number(t.target.value)),className:"w-full h-1.5 bg-slate-200 rounded-lg accent-emerald-500"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500",children:"右 (Right)"}),e.jsx("input",{type:"range",min:a.ranges.padding.min,max:a.ranges.padding.max,value:f,onChange:t=>S(Number(t.target.value)),className:"w-full h-1.5 bg-slate-200 rounded-lg accent-emerald-500"})]})]})]})]})]}),e.jsxs("div",{className:"p-4 border-t border-slate-200 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 text-slate-700",children:[e.jsx(J,{className:"w-4 h-4 text-purple-500"}),e.jsx("span",{className:"text-sm font-bold",children:"背景設定"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("label",{className:"flex items-center justify-between cursor-pointer",children:[e.jsx("span",{className:"text-xs font-bold text-slate-600",children:"透明背景"}),e.jsxs("div",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:R,onChange:t=>W(t.target.checked),className:"sr-only peer"}),e.jsx("div",{className:"w-9 h-5 bg-slate-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-purple-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-purple-500"})]})]}),!R&&e.jsxs("div",{className:"space-y-2 animate-in fade-in slide-in-from-top-2 duration-300",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"text-xs font-bold text-slate-600",children:"背景顏色"}),e.jsx("span",{className:"text-xs font-mono text-slate-500 uppercase",children:i})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"color",value:i,onChange:t=>Y(t.target.value),className:"h-8 w-12 p-0 border-0 rounded cursor-pointer"}),e.jsx("input",{type:"text",value:i,onChange:t=>Y(t.target.value),className:"flex-1 text-xs border border-slate-200 rounded px-2 font-mono uppercase focus:outline-none focus:border-purple-500",placeholder:"#FFFFFF"})]})]})]})]}),e.jsx("div",{className:"p-4",children:e.jsxs("label",{className:"flex flex-col items-center justify-center w-full h-16 border-2 border-dashed border-indigo-200 rounded-xl cursor-pointer bg-indigo-50/50 hover:bg-indigo-50 transition-colors group",children:[e.jsxs("div",{className:"flex items-center gap-2 text-indigo-400 group-hover:text-indigo-600",children:[e.jsx(ne,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs font-bold",children:"上傳 / 貼上圖片"})]}),e.jsx("input",{type:"file",className:"hidden",accept:"image/jpeg, image/png",multiple:!0,onChange:j})]})})]}),e.jsxs("div",{className:"h-48 border-t border-slate-200 bg-slate-50 flex flex-col",children:[e.jsxs("div",{className:"p-2 border-b border-slate-100 flex justify-between items-center bg-white",children:[e.jsxs("span",{className:"text-xs font-bold text-slate-500 flex items-center gap-1",children:[e.jsx(Z,{className:"w-3 h-3"})," 歷史 (",O.length,")"]}),O.length>0&&e.jsx("button",{onClick:()=>E([]),className:"text-slate-400 hover:text-red-500 p-1 rounded hover:bg-red-50",children:e.jsx(re,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-2 space-y-2 custom-scrollbar",children:[O.map(t=>e.jsxs("div",{onClick:()=>L(t),className:`flex items-center gap-2 p-2 rounded-lg cursor-pointer border transition-all relative group
                                ${l?.id===t.id?"bg-white border-indigo-500 shadow-md ring-1 ring-indigo-500":"bg-white border-slate-200 hover:border-indigo-300"}
`,children:[e.jsx("div",{className:"w-10 h-10 bg-slate-100 rounded overflow-hidden flex-shrink-0 border border-slate-100",children:t.status==="processing"?e.jsx("div",{className:"w-full h-full flex items-center justify-center text-indigo-500",children:e.jsx(Q,{className:"w-3 h-3 animate-spin"})}):e.jsx("img",{src:t.processedUrl||t.originalUrl,className:"w-full h-full object-cover",alt:"thumb"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:`text-xs font-bold truncate ${l?.id===t.id?"text-indigo-700":"text-slate-700"} `,children:t.name}),e.jsxs("p",{className:"text-[9px] text-slate-400 flex gap-1 items-center mt-0.5",children:[t.settingsUsed.algorithm==="adaptive"?"自適應":"經典",t.settingsUsed.scaleMultiplier>1&&e.jsxs("span",{className:"bg-amber-100 text-amber-700 px-1 rounded",children:[t.settingsUsed.scaleMultiplier,"x"]})]})]}),e.jsx("button",{onClick:s=>g(t.id,s),className:"p-1 text-slate-300 hover:text-red-500 rounded opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(ie,{className:"w-3 h-3"})})]},t.id)),O.length===0&&e.jsx("div",{className:"text-center py-4 text-slate-300 text-xs",children:"暫無紀錄"})]})]})]}),e.jsx("div",{className:"flex-1 bg-slate-200/80 relative flex flex-col h-[55vh] md:h-full",children:l?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"absolute top-4 right-4 z-30 flex gap-2",children:[e.jsxs("div",{className:"bg-white/90 backdrop-blur shadow-sm rounded-lg p-1 flex gap-1 border border-slate-200",children:[e.jsx("button",{onClick:()=>P("original"),className:`p-1.5 rounded-md transition-all ${D==="original"?"bg-indigo-100 text-indigo-600":"text-slate-400 hover:text-slate-600 hover:bg-slate-100"} `,title:"僅原圖 (Original Only)",children:e.jsx(Z,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>P("split"),className:`p-1.5 rounded-md transition-all ${D==="split"?"bg-indigo-100 text-indigo-600":"text-slate-400 hover:text-slate-600 hover:bg-slate-100"} `,title:"對比模式 (Split View)",children:e.jsx(me,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>P("processed"),className:`p-1.5 rounded-md transition-all ${D==="processed"?"bg-indigo-100 text-indigo-600":"text-slate-400 hover:text-slate-600 hover:bg-slate-100"} `,title:"僅成品 (Processed Only)",children:e.jsx(J,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"w-px h-8 bg-slate-300 mx-1 self-center"}),e.jsxs("button",{onClick:()=>v(l),disabled:l.status!=="done",className:`px-4 py-2 rounded-full shadow-lg font-bold text-sm flex items-center gap-2 transition-transform active:scale-95
                                ${l.status==="done"?"bg-indigo-600 text-white hover:bg-indigo-700":"bg-slate-300 text-slate-500 cursor-not-allowed"}
`,children:[e.jsx(oe,{className:"w-4 h-4"})," 下載成品"]})]}),e.jsx("div",{className:"flex-1 w-full h-full relative",children:l.status==="processing"?e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-indigo-600",children:[e.jsx(Q,{className:"w-10 h-10 animate-spin mb-3"}),e.jsx("p",{className:"font-bold",children:"正在處理..."})]}):l.status==="error"?e.jsx("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-red-500",children:e.jsx("p",{children:"處理失敗"})}):e.jsx(ke,{originalUrl:l.originalUrl,processedUrl:l.processedUrl,croppedOriginalUrl:l.croppedOriginalUrl,settings:l.settingsUsed,viewMode:D})})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-slate-400",children:[e.jsx("div",{className:"p-6 bg-slate-100 rounded-full mb-4",children:e.jsx(te,{className:"w-10 h-10 text-slate-300"})}),e.jsx("p",{className:"font-bold",children:"請選擇或上傳一張圖片"}),e.jsx("p",{className:"text-sm mt-1",children:"左側歷史紀錄可切換檢視"})]})}),e.jsx("style",{children:`
            .custom-scrollbar::-webkit-scrollbar { width: 4px; }
            .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
            .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
`})]})};de.createRoot(document.getElementById("root")).render(e.jsx(c.StrictMode,{children:e.jsx(Ue,{})}));
