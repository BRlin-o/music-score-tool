import{c as y,r as i,j as e,S as U,Z as M,U as R,I as E,T as $,L as k,X as L,D as I,a as _}from"./zap-mdVrQ8AZ.js";const D=[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]],C=y("arrow-right-left",D);const P=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}]],z=y("clipboard",P);const F=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],H=y("history",F),T=async(f,x)=>new Promise((o,g)=>{const a=new Image;a.crossOrigin="Anonymous",a.onload=()=>{try{const{threshold:h,contrastBoost:m,superResolution:v}=x,p=a.width*(v?2:1),w=p/a.width,d=a.height*w,b=document.createElement("canvas");b.width=p,b.height=d;const j=b.getContext("2d");if(!j)throw new Error("Could not get canvas context");j.imageSmoothingEnabled=!0,j.imageSmoothingQuality="high",j.drawImage(a,0,0,p,d);const s=j.getImageData(0,0,p,d),t=s.data,l=m/100;for(let n=0;n<t.length;n+=4){let r=t[n];r<h+40&&(r=r*(1-l));const c=r<h?0:255;t[n]=c,t[n+1]=c,t[n+2]=c}j.putImageData(s,0,0),o(b.toDataURL("image/png"))}catch(h){g(h)}},a.onerror=h=>g(h),a.src=f}),B=({originalUrl:f,processedUrl:x,settings:o})=>{const[g,a]=i.useState(50),h=i.useRef(null),m=i.useRef(!1),v=i.useCallback(d=>{if(!h.current)return;const b=h.current.getBoundingClientRect(),s=Math.max(0,Math.min(d-b.left,b.width))/b.width*100;a(s)},[]),u=()=>m.current=!0,N=()=>m.current=!1,p=d=>{m.current&&v(d.clientX)},w=d=>{v(d.touches[0].clientX)};return i.useEffect(()=>{a(50)},[f]),i.useEffect(()=>{const d=()=>m.current=!1;return window.addEventListener("mouseup",d),()=>window.removeEventListener("mouseup",d)},[]),f?e.jsx("div",{className:"relative w-full h-full flex items-center justify-center bg-slate-200/50 overflow-hidden select-none",onMouseMove:p,onMouseUp:N,onTouchMove:w,children:e.jsxs("div",{ref:h,className:"relative max-w-full max-h-full shadow-2xl bg-white",style:{aspectRatio:"auto"},children:[e.jsx("img",{src:f,alt:"Original",className:"block max-w-full max-h-[85vh] object-contain pointer-events-none",draggable:"false"}),x&&e.jsx("div",{className:"absolute inset-0 overflow-hidden",style:{width:`${g}%`},children:e.jsx("img",{src:x,alt:"Processed",className:"block w-full h-full object-contain pointer-events-none max-w-none"})}),x&&e.jsx("img",{src:x,alt:"Processed Overlay",className:"absolute inset-0 w-full h-full object-contain pointer-events-none bg-white",style:{clipPath:`inset(0 ${100-g}% 0 0)`}}),e.jsx("div",{className:"absolute inset-y-0 w-1 bg-indigo-500 cursor-ew-resize z-20 hover:bg-indigo-400 transition-colors shadow-[0_0_10px_rgba(0,0,0,0.3)]",style:{left:`${g}%`},onMouseDown:u,onTouchStart:u,children:e.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-8 h-8 bg-indigo-600 rounded-full flex items-center justify-center shadow-lg border-2 border-white text-white",children:e.jsx(C,{className:"w-4 h-4"})})}),e.jsxs("div",{className:"absolute top-4 left-4 bg-black/60 text-white text-xs px-2 py-1 rounded backdrop-blur-sm z-10 pointer-events-none",children:["處理後 (Processed) ",o?.superResolution&&e.jsx("span",{className:"text-amber-300 font-bold ml-1",children:"HQ"})]}),e.jsx("div",{className:"absolute top-4 right-4 bg-black/60 text-white text-xs px-2 py-1 rounded backdrop-blur-sm z-10 pointer-events-none",children:"原始 (Original)"})]})}):null},O=()=>{const[f,x]=i.useState([]),[o,g]=i.useState(null),[a,h]=i.useState(140),[m,v]=i.useState(20),[u,N]=i.useState(!1),p=i.useRef({threshold:a,contrastBoost:m,superResolution:u});i.useEffect(()=>{p.current={threshold:a,contrastBoost:m,superResolution:u}},[a,m,u]);const w=i.useCallback(async s=>{if(s.length===0)return;const t=s.map(l=>({id:Math.random().toString(36).substr(2,9),name:l.name.split(".")[0]||"Screenshot",originalUrl:URL.createObjectURL(l),processedUrl:null,status:"processing",timestamp:new Date,settingsUsed:{...p.current}}));x(l=>[...t,...l]),t.length>0&&g(t[0]),t.forEach(async l=>{try{const n=await T(l.originalUrl,l.settingsUsed);x(r=>r.map(c=>c.id===l.id?{...c,processedUrl:n,status:"done"}:c)),g(r=>r&&r.id===l.id?{...l,processedUrl:n,status:"done"}:r)}catch(n){console.error("Processing failed:",n),x(r=>r.map(c=>c.id===l.id?{...c,status:"error"}:c))}})},[]),d=s=>{s.target.files&&(w(Array.from(s.target.files)),s.target.value="")};i.useEffect(()=>{const s=t=>{const l=t.clipboardData?.items;if(!l)return;const n=[];for(let r=0;r<l.length;r++)if(l[r].type.indexOf("image")!==-1){const c=l[r].getAsFile();if(c){const S=new File([c],`Paste_${new Date().toLocaleTimeString("en-GB").replace(/:/g,"")}.png`,{type:c.type});n.push(S)}}n.length>0&&w(n)};return window.addEventListener("paste",s),()=>window.removeEventListener("paste",s)},[w]);const b=s=>{if(!s||!s.processedUrl)return;const t=document.createElement("a");t.href=s.processedUrl;const l=s.settingsUsed.superResolution?"_HQ":"";t.download=`${s.name}_clean${l}.png`,document.body.appendChild(t),t.click(),document.body.removeChild(t)},j=(s,t)=>{t.stopPropagation(),x(l=>l.filter(n=>n.id!==s)),o?.id===s&&g(null)};return e.jsxs("div",{className:"h-screen bg-slate-100 text-slate-800 font-sans flex flex-col md:flex-row overflow-hidden",children:[e.jsxs("div",{className:"w-full md:w-80 lg:w-96 bg-white border-r border-slate-200 flex flex-col h-[40vh] md:h-full z-10 shadow-xl",children:[e.jsxs("div",{className:"p-4 border-b border-slate-100",children:[e.jsxs("h1",{className:"text-xl font-bold text-slate-900 flex items-center gap-2",children:[e.jsx(H,{className:"w-6 h-6 text-indigo-600"}),"樂譜工作站"]}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1 flex items-center gap-1",children:[e.jsx(z,{className:"w-3 h-3"})," Ctrl+V 貼上 / 拖曳上傳"]})]}),e.jsxs("div",{className:"p-4 space-y-5 overflow-y-auto flex-shrink-0 custom-scrollbar",children:[e.jsx("div",{className:`relative overflow-hidden rounded-lg p-3 border-2 transition-all cursor-pointer group select-none ${u?"border-amber-400 bg-amber-50":"border-slate-200 bg-slate-50 hover:border-amber-200"}`,onClick:()=>N(!u),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`p-1.5 rounded-md ${u?"bg-amber-400 text-white":"bg-slate-200 text-slate-400"}`,children:e.jsx(U,{className:"w-4 h-4"})}),e.jsx("span",{className:`font-bold text-sm ${u?"text-amber-900":"text-slate-600"}`,children:"2x 超解析優化"})]}),u&&e.jsx(M,{className:"w-3 h-3 text-amber-500 fill-current"})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("label",{className:"text-xs font-bold text-slate-600",children:"黑白閾值"}),e.jsx("span",{className:"text-xs font-mono text-indigo-600",children:a})]}),e.jsx("input",{type:"range",min:"50",max:"220",value:a,onChange:s=>h(Number(s.target.value)),className:"w-full h-1.5 bg-slate-200 rounded-lg accent-indigo-600"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("label",{className:"text-xs font-bold text-slate-600",children:"墨色加深"}),e.jsxs("span",{className:"text-xs font-mono text-indigo-600",children:[m,"%"]})]}),e.jsx("input",{type:"range",min:"0",max:"60",value:m,onChange:s=>v(Number(s.target.value)),className:"w-full h-1.5 bg-slate-200 rounded-lg accent-indigo-600"})]})]}),e.jsxs("label",{className:"flex flex-col items-center justify-center w-full h-20 border-2 border-dashed border-indigo-200 rounded-xl cursor-pointer bg-indigo-50/50 hover:bg-indigo-50 transition-colors group",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center text-indigo-400 group-hover:text-indigo-600",children:[e.jsx(R,{className:"w-5 h-5 mb-1"}),e.jsx("span",{className:"text-xs font-bold",children:"點擊上傳圖片 或 Ctrl+V 貼上"})]}),e.jsx("input",{type:"file",className:"hidden",accept:"image/jpeg, image/png",multiple:!0,onChange:d})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col min-h-0 border-t border-slate-100 bg-slate-50",children:[e.jsxs("div",{className:"p-3 border-b border-slate-100 flex justify-between items-center bg-white sticky top-0 z-10",children:[e.jsxs("span",{className:"text-xs font-bold text-slate-500 flex items-center gap-1",children:[e.jsx(E,{className:"w-3 h-3"})," 歷史紀錄 (",f.length,")"]}),f.length>0&&e.jsx("button",{onClick:()=>x([]),className:"text-slate-400 hover:text-red-500 p-1 rounded hover:bg-red-50",children:e.jsx($,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-2 space-y-2 custom-scrollbar",children:[f.map(s=>e.jsxs("div",{onClick:()=>g(s),className:`flex items-center gap-3 p-2 rounded-lg cursor-pointer border transition-all relative group
                                ${o?.id===s.id?"bg-white border-indigo-500 shadow-md ring-1 ring-indigo-500":"bg-white border-slate-200 hover:border-indigo-300"}
                            `,children:[e.jsx("div",{className:"w-12 h-12 bg-slate-100 rounded overflow-hidden flex-shrink-0 border border-slate-100",children:s.status==="processing"?e.jsx("div",{className:"w-full h-full flex items-center justify-center text-indigo-500",children:e.jsx(k,{className:"w-4 h-4 animate-spin"})}):e.jsx("img",{src:s.processedUrl||s.originalUrl,className:"w-full h-full object-cover",alt:"thumb"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:`text-xs font-bold truncate ${o?.id===s.id?"text-indigo-700":"text-slate-700"}`,children:s.name}),e.jsxs("p",{className:"text-[10px] text-slate-400 mt-0.5 flex gap-1",children:[s.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),s.settingsUsed.superResolution&&e.jsx("span",{className:"text-amber-500 font-bold",children:"HQ"})]})]}),e.jsx("button",{onClick:t=>j(s.id,t),className:"absolute right-2 top-1/2 -translate-y-1/2 p-1.5 text-slate-300 hover:text-red-500 hover:bg-red-50 rounded opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(L,{className:"w-3 h-3"})})]},s.id)),f.length===0&&e.jsx("div",{className:"text-center py-8 text-slate-300 text-xs",children:"暫無紀錄"})]})]})]}),e.jsx("div",{className:"flex-1 bg-slate-200/80 relative flex flex-col h-[60vh] md:h-full",children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute top-4 right-4 z-30 flex gap-2",children:e.jsxs("button",{onClick:()=>b(o),disabled:o.status!=="done",className:`px-4 py-2 rounded-full shadow-lg font-bold text-sm flex items-center gap-2 transition-transform active:scale-95
                                ${o.status==="done"?"bg-indigo-600 text-white hover:bg-indigo-700":"bg-slate-300 text-slate-500 cursor-not-allowed"}
                            `,children:[e.jsx(I,{className:"w-4 h-4"})," 下載成品"]})}),e.jsx("div",{className:"flex-1 w-full h-full relative",children:o.status==="processing"?e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-indigo-600",children:[e.jsx(k,{className:"w-10 h-10 animate-spin mb-3"}),e.jsx("p",{className:"font-bold",children:"正在處理..."})]}):o.status==="error"?e.jsx("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-red-500",children:e.jsx("p",{children:"處理失敗"})}):e.jsx(B,{originalUrl:o.originalUrl,processedUrl:o.processedUrl,settings:o.settingsUsed})})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-slate-400",children:[e.jsx("div",{className:"p-6 bg-slate-100 rounded-full mb-4",children:e.jsx(C,{className:"w-10 h-10 text-slate-300"})}),e.jsx("p",{className:"font-bold",children:"請選擇或上傳一張圖片"}),e.jsx("p",{className:"text-sm mt-1",children:"左側歷史紀錄可切換檢視"})]})}),e.jsx("style",{children:`
            .custom-scrollbar::-webkit-scrollbar { width: 4px; }
            .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
            .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        `})]})};_.createRoot(document.getElementById("root")).render(e.jsx(i.StrictMode,{children:e.jsx(O,{})}));
