import{c as M,r as d,j as e,D as _,I as O,U as z,X as B,T as H,S as W,Z,L as $,a as Q}from"./zap-mdVrQ8AZ.js";const X=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],Y=M("arrow-down",X);const G=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],J=M("arrow-up",G);const K=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],T=M("layers",K);const ee=[["path",{d:"M10 8h4",key:"1sr2af"}],["path",{d:"M12 21v-9",key:"17s77i"}],["path",{d:"M12 8V3",key:"13r4qs"}],["path",{d:"M17 16h4",key:"h1uq16"}],["path",{d:"M19 12V3",key:"o1uvq1"}],["path",{d:"M19 21v-5",key:"qua636"}],["path",{d:"M3 14h4",key:"bcjad9"}],["path",{d:"M5 10V3",key:"cb8scm"}],["path",{d:"M5 21v-7",key:"1w1uti"}]],te=M("sliders-vertical",ee),se=()=>{const[c,f]=d.useState([]),[p,C]=d.useState(null),[R,S]=d.useState(!1),v=d.useRef(null),[j,F]=d.useState(140),[y,D]=d.useState(20),[r,A]=d.useState(!1);d.useEffect(()=>{const t=n=>{const s=n.clipboardData?.items;if(!s)return;const l=[];for(let o=0;o<s.length;o++)if(s[o].type.indexOf("image")!==-1){const a=s[o].getAsFile();a&&l.push(a)}if(l.length>0){const o=l.map(a=>new Promise(i=>{const b=new Image,k=URL.createObjectURL(a);b.onload=()=>{i({id:Math.random().toString(36).substr(2,9),file:a,preview:k,name:a.name||`pasted_image_${new Date().getTime()}.png`,width:b.width,height:b.height})},b.src=k}));Promise.all(o).then(a=>{f(i=>[...i,...a])})}};return window.addEventListener("paste",t),()=>{window.removeEventListener("paste",t)}},[]);const q=t=>{const n=Array.from(t.target.files||[]);if(n.length===0)return;const s=n.map(l=>new Promise(o=>{const a=new Image,i=URL.createObjectURL(l);a.onload=()=>{o({id:Math.random().toString(36).substr(2,9),file:l,preview:i,name:l.name,width:a.width,height:a.height})},a.src=i}));Promise.all(s).then(l=>{f(o=>[...o,...l])})},V=t=>{f(n=>{const s=n.filter(o=>o.id!==t),l=n.find(o=>o.id===t);return l&&URL.revokeObjectURL(l.preview),s})},E=(t,n)=>{if(n==="up"&&t>0){const s=[...c];[s[t],s[t-1]]=[s[t-1],s[t]],f(s)}else if(n==="down"&&t<c.length-1){const s=[...c];[s[t],s[t+1]]=[s[t+1],s[t]],f(s)}},L=d.useCallback(async()=>{if(c.length===0){C(null);return}S(!0);try{const t=await Promise.all(c.map(h=>new Promise((w,u)=>{const m=new Image;m.crossOrigin="Anonymous",m.onload=()=>w(m),m.onerror=u,m.src=h.preview}))),l=Math.max(...t.map(h=>h.width))*(r?2:1),o=t.reduce((h,w)=>{const u=l/w.width;return h+w.height*u},0);o>3e4&&alert("警告：合併後的圖片高度可能超出瀏覽器限制，建議分批處理。");const a=document.createElement("canvas");a.width=l,a.height=o;const i=a.getContext("2d");if(!i)throw new Error("Could not get canvas context");i.fillStyle="#FFFFFF",i.fillRect(0,0,a.width,a.height);let b=0;const k=y/100;for(const h of t){const w=l/h.width,u=h.height*w,m=document.createElement("canvas");m.width=l,m.height=u;const N=m.getContext("2d");if(!N)continue;N.imageSmoothingEnabled=!0,N.imageSmoothingQuality="high",N.drawImage(h,0,0,l,u);const U=N.getImageData(0,0,l,u),g=U.data;for(let x=0;x<g.length;x+=4){let I=g[x];I<j+40&&(I=I*(1-k)),I<j?(g[x]=0,g[x+1]=0,g[x+2]=0):(g[x]=255,g[x+1]=255,g[x+2]=255)}N.putImageData(U,0,0),i.drawImage(m,0,b),b+=u}C(a.toDataURL("image/png"))}catch(t){console.error("Error processing images:",t)}finally{S(!1)}},[c,j,y,r]);d.useEffect(()=>{if(v.current&&clearTimeout(v.current),c.length===0){C(null);return}const t=r?600:300;return v.current=setTimeout(()=>{L()},t),()=>{v.current&&clearTimeout(v.current)}},[c,j,y,r,L]);const P=()=>{if(!p)return;const t=document.createElement("a");t.href=p;const n=r?"_HighRes":"";t.download=`sheet_music${n}_${new Date().getTime()}.png`,document.body.appendChild(t),t.click(),document.body.removeChild(t)};return e.jsxs("div",{className:"min-h-screen bg-slate-50 text-slate-800 p-4 md:p-8 font-sans font-medium",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("header",{className:"mb-8 text-center md:text-left border-b border-slate-200 pb-6 flex flex-col md:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-slate-900 flex items-center justify-center md:justify-start gap-3",children:[e.jsx(T,{className:"w-8 h-8 text-indigo-600"}),"樂譜圖床與合併工具 (旗艦版)"]}),e.jsx("p",{className:"text-slate-500 mt-2",children:"紅光濾鏡去背 + 2x 超解析度重建 (Super Resolution)"})]}),p&&e.jsx("div",{className:"hidden md:block",children:e.jsxs("button",{onClick:P,className:"px-6 py-3 rounded-xl bg-indigo-600 text-white font-bold shadow-lg hover:bg-indigo-700 hover:shadow-xl transition-all flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5"}),"下載成品"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8 items-start",children:[e.jsxs("div",{className:"lg:col-span-4 space-y-6 sticky top-8",children:[e.jsxs("div",{className:"bg-white p-5 rounded-xl shadow-sm border border-slate-200",children:[e.jsxs("h2",{className:"text-lg font-bold mb-4 flex items-center gap-2 text-slate-700",children:[e.jsx(O,{className:"w-5 h-5"}),"步驟 1: 上傳圖片"]}),e.jsxs("label",{className:"flex flex-col items-center justify-center w-full h-28 border-2 border-dashed border-indigo-200 rounded-xl cursor-pointer bg-indigo-50/30 hover:bg-indigo-50 transition-colors",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center pt-2",children:[e.jsx(z,{className:"w-8 h-8 mb-1 text-indigo-400"}),e.jsx("p",{className:"text-sm text-slate-600",children:"點擊上傳多張截圖 或 Ctrl+V 貼上"})]}),e.jsx("input",{type:"file",className:"hidden",accept:"image/jpeg, image/png",multiple:!0,onChange:q})]}),e.jsxs("div",{className:"mt-4 space-y-2 max-h-[200px] overflow-y-auto pr-1 custom-scrollbar",children:[c.map((t,n)=>e.jsxs("div",{className:"flex items-center gap-3 bg-slate-50 p-2 rounded-lg border border-slate-100",children:[e.jsx("img",{src:t.preview,alt:"thumb",className:"w-8 h-8 rounded object-cover border border-slate-200"}),e.jsxs("span",{className:"text-xs font-bold text-slate-400 w-4",children:["#",n+1]}),e.jsx("p",{className:"text-xs text-slate-600 truncate flex-1",children:t.name}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>E(n,"up"),className:"p-1 hover:bg-slate-200 rounded text-slate-500",children:e.jsx(J,{className:"w-3 h-3"})}),e.jsx("button",{onClick:()=>E(n,"down"),className:"p-1 hover:bg-slate-200 rounded text-slate-500",children:e.jsx(Y,{className:"w-3 h-3"})}),e.jsx("button",{onClick:()=>V(t.id),className:"p-1 hover:bg-red-100 rounded text-red-400",children:e.jsx(B,{className:"w-3 h-3"})})]})]},t.id)),c.length===0&&e.jsx("p",{className:"text-center text-xs text-slate-400 py-2",children:"尚未選擇圖片"}),c.length>0&&e.jsxs("button",{onClick:()=>f([]),className:"w-full text-xs text-red-400 hover:text-red-600 flex items-center justify-center gap-1 py-1 mt-2 hover:bg-red-50 rounded",children:[e.jsx(H,{className:"w-3 h-3"})," 清空"]})]})]}),e.jsxs("div",{className:`bg-white p-5 rounded-xl shadow-sm border border-slate-200 transition-opacity ${c.length===0?"opacity-50 pointer-events-none":"opacity-100"}`,children:[e.jsxs("h2",{className:"text-lg font-bold mb-5 flex items-center gap-2 text-slate-700",children:[e.jsx(te,{className:"w-5 h-5"}),"步驟 2: 畫質與參數"]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:`relative overflow-hidden rounded-xl p-4 border-2 transition-all cursor-pointer group ${r?"border-amber-400 bg-amber-50":"border-slate-200 bg-slate-50 hover:border-amber-200"}`,onClick:()=>A(!r),children:[e.jsxs("div",{className:"flex items-center justify-between relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${r?"bg-amber-400 text-white":"bg-slate-200 text-slate-400"}`,children:e.jsx(W,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h3",{className:`font-bold text-sm ${r?"text-amber-900":"text-slate-600"}`,children:"2x 超解析優化"}),e.jsx("p",{className:`text-xs ${r?"text-amber-700":"text-slate-400"}`,children:r?"已開啟：平滑邊緣，消除鋸齒":"點擊開啟高畫質重建"})]})]}),e.jsx("div",{className:`w-5 h-5 rounded-full border flex items-center justify-center ${r?"bg-amber-500 border-amber-500":"border-slate-300 bg-white"}`,children:r&&e.jsx(Z,{className:"w-3 h-3 text-white fill-current"})})]}),r&&e.jsx("div",{className:"absolute -right-4 -bottom-4 w-20 h-20 bg-amber-200/50 rounded-full blur-xl"})]}),e.jsxs("div",{className:"space-y-3 pt-2",children:[e.jsxs("div",{className:"flex justify-between items-end",children:[e.jsx("label",{className:"text-sm font-bold text-slate-700",children:"黑白臨界值 (Threshold)"}),e.jsx("span",{className:"text-sm font-mono text-indigo-600 bg-indigo-50 px-2 rounded",children:j})]}),e.jsx("input",{type:"range",min:"50",max:"220",value:j,onChange:t=>F(Number(t.target.value)),className:"w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-indigo-600"}),e.jsx("p",{className:"text-xs text-slate-400",children:"往左筆畫細，往右筆畫粗 (建議值: 140)"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-end",children:[e.jsx("label",{className:"text-sm font-bold text-slate-700",children:"墨色加深 (Ink Boost)"}),e.jsxs("span",{className:"text-sm font-mono text-indigo-600 bg-indigo-50 px-2 rounded",children:[y,"%"]})]}),e.jsx("input",{type:"range",min:"0",max:"60",value:y,onChange:t=>D(Number(t.target.value)),className:"w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-indigo-600"}),e.jsx("p",{className:"text-xs text-slate-400",children:"增強淡色音符的深度"})]})]}),R&&e.jsxs("div",{className:"mt-6 p-3 bg-blue-50 text-blue-700 rounded-lg flex items-center justify-center gap-2 animate-pulse text-sm",children:[e.jsx($,{className:"w-4 h-4 animate-spin"}),r?"正在進行超解析重建運算...":"正在處理影像..."]})]})]}),e.jsx("div",{className:"lg:col-span-8",children:e.jsxs("div",{className:"bg-slate-200/50 rounded-xl border border-slate-200 h-[85vh] flex flex-col overflow-hidden relative shadow-inner",children:[R&&c.length>0&&e.jsxs("div",{className:"absolute inset-0 bg-white/60 backdrop-blur-sm z-20 flex flex-col items-center justify-center text-indigo-600",children:[e.jsx($,{className:"w-12 h-12 animate-spin mb-4"}),e.jsx("p",{className:"font-bold text-lg",children:r?"AI 級插值運算中...":"處理中..."}),r&&e.jsx("p",{className:"text-sm text-indigo-400 mt-1",children:"超解析度模式需要較多運算時間"})]}),!p&&!R?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-slate-400",children:[e.jsx("div",{className:"p-8 bg-white rounded-full mb-6 shadow-sm",children:e.jsx(T,{className:"w-16 h-16 text-slate-200"})}),e.jsx("p",{className:"text-xl font-bold text-slate-500",children:"等待圖片輸入"}),e.jsx("p",{className:"mt-2",children:"請在左側上傳您的樂譜"})]}):p&&e.jsx("div",{className:"flex-1 overflow-auto p-4 md:p-8 flex justify-center items-start",children:e.jsx("img",{src:p,alt:"Processed Result",className:"max-w-full shadow-2xl border border-white bg-white",style:{minHeight:"200px",imageRendering:"auto"}})}),p&&e.jsx("div",{className:"absolute bottom-6 right-6 md:hidden",children:e.jsx("button",{onClick:P,className:"w-14 h-14 bg-indigo-600 rounded-full text-white shadow-xl flex items-center justify-center hover:bg-indigo-700 active:scale-95 transition-all",children:e.jsx(_,{className:"w-6 h-6"})})})]})})]})]}),e.jsx("style",{children:`
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
      `})]})};Q.createRoot(document.getElementById("root")).render(e.jsx(d.StrictMode,{children:e.jsx(se,{})}));
